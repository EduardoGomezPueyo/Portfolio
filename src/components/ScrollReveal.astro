---
interface Props {
  class?: string;
  delay?: number;
}

const { class: className = '', delay = 0 } = Astro.props;
---

<div class:list={['scroll-reveal', className]} style={delay ? `transition-delay: ${delay}ms` : ''}>
  <slot />
</div>

<style>
  .scroll-reveal {
    opacity: 0;
    transform: translateY(1.5rem);
    transition: opacity 0.7s ease-out, transform 0.7s ease-out;
  }

  .scroll-reveal.is-visible {
    opacity: 1;
    transform: translateY(0);
  }

  @media (prefers-reduced-motion: reduce) {
    .scroll-reveal {
      opacity: 1;
      transform: none;
      transition: none;
    }
  }
</style>

<script>
  function setupScrollReveal() {
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.classList.add('is-visible');
            observer.unobserve(entry.target);
          }
        });
      },
      { threshold: 0.1, rootMargin: '0px 0px -50px 0px' }
    );

    document.querySelectorAll('.scroll-reveal').forEach((el) => {
      observer.observe(el);
    });
  }

  setupScrollReveal();
  document.addEventListener('astro:after-swap', setupScrollReveal);
</script>
